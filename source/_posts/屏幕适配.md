---
title: 屏幕适配
date: '2014/10/1 12:30:00'
tags:
  - coso2d-x
abbrlink: 9233ed3f
---

## 概要
从Cocos2d-x 2.0.4开始，Cocos2d-x提出了自己的多分辨率支持方案，废弃了之前的retina相关设置接口，提出了design resolution概念。  
3.0中有以下相关接口

	Director::getInstance()->getOpenGLView->setDesignResolutionSize()  //设计分辨率大小及模式

	Director::getInstance()->setContentScaleFactor()  //内容缩放因子
	FileUtils::getInstance()->setSearchPaths() //资源搜索路径，取代2.1的setResourceDirectory()
	Director::getInstance()->getOpenGLView()->getFrameSize()  //屏幕分辨率
	Director::getInstance()->getWinSize()  //设计分辨率
	Director::getInstance()->getVisibleSize() //设计分辨率可视区域大小
	Director::getInstance()->getVisibleOrign() //设计分辨率可视区域起点

<!-- more -->

## 资源分辨率，设计分辨率，屏幕分辨率
### 资源分辨率->设计分辨率
`setSearchPaths()`需要根据当前屏幕分辨率做恰当的设置  

`setContentScaleFactor()`决定了图片显示到屏幕的缩放因子，这个因子是资源宽、高比设计分辨率宽高、
`setContentScaleFactor()`通常有两种方式来设置参数`RH/DH`或`RW/DW`  
用高度比作为内容缩放因子，保证了背景资源的垂直方向在设计分辨率范围内的全部显示。  
用宽度比则保证了水平方向。

### 设计分辨率->屏幕分辨率
	setDesignResolutionSize(DW,DH,resolutionPolicy) //设计分辨率宽、高、分辨率策略

设计分辨率策略：

* `ResolutionPolicy::EXACT_FIT`:屏幕宽与设计宽比作为X方向缩放因子，屏幕高与设计高比作为Y方向缩放因子。保证了设计区域完全铺满屏幕，但是可能会出现图像拉伸。  
scaleX=SW/DW  
scaleY=SH/DH
* `ResolutionPolicy::NO_BORDER`:屏幕宽、高分辨和设计分辨率宽、高计算缩放因子，取较`大`者作为宽、高缩放因子。保证了设计区域总能一个方向上铺满屏幕，而另一个方向一般会超出屏幕区域。  
scaleX=scaleY=MAX(SH/DH,SW/DW)
* `ResolutionPolicy::SHOW_ALL`:屏幕宽、高分别和设计分辨率宽、高计算缩放因子，取较`小`者作为宽、高缩放因子。保证了设计趋于全部显示到屏幕上，但可能会有黑边。  
scaleX = scaleY = MIN(SW/DW,SH/DH)  
* `ResolutionPolicy::FIXED_HEIGHT`:保持传入的设计分辨率高度不变，根据分辨率修正设计分辨率的宽度。  
scaleX=scaleY=SH/DH  
DW=ceilf(SW/scaleX)
* `ResolutionPolicy::FIXED_WIDTH`:保持传入的设计分辨率宽度不变，根据分辨率修正设计分辨率的高度。  
scaleX=scaleY=SW/DW  
DH=ceilf(SH/scaleY)

前3个不会在内部修正传入的设计分辨率，后2个（2.1.3加入）会修正以保证屏幕分辨率到设计分辨率无拉伸铺满屏幕。  
官方推荐`NO_BORDER`，因为他没有拉伸图像，同时在一个方向上撑满了屏幕。后2种策略撼动`NO_BORDER`的地位。

## 小结
推荐使用：

* `ResolutionPolicy::FIXED_HEIGHT`结合`setContentScaleFactor(RH/DH)`使用，适合高方向需要撑满，宽方向可裁剪的游戏。
* `ResolutionPolicy::FIXED_WIDTH`结合`SetContentScaleFactor(RW/DW)`使用，适合宽方向需要撑满，高方向可裁剪的游戏。
